# ПИД контроллер для AVR


Используется библиотека [AvrSimplePID](https://github.com/uLipe/AvrSimplePID). Простой, быстрый цифровой ПИД контроллер для AVR микроконтроллеров, использующий числа с фиксированной точкой.

Работа ПИД контроллера ведется в относительных единицах.

Применяемый тип данных IQ8 означает 7 бит дробной части + 1 бит знака. Целая часть отсутствует.

Используются три функции:
 - `PidControllerInit` - инициализация ПИД контроллера (установка коэффициентов);
 - `PidControllerTune` - подстройка коэффициентов ПИД контроллера на лету;
 - `PidControllerUpdate` - обновление ПИД контроллера и вычисление выходного значения.

## Сборка проекта под Windows

Для компиляции программ на языке C для микроконтроллеров AVR используется AVR GCC toolchain.

1. Тулчейн AVR GCC для Windows можно скачать, например, [здесь](https://blog.zakkemble.net/avr-gcc-builds/).
2. Тулчейн необходимо распаковать в директорию `c:\avr-gcc`. 
3. Добавить диреткорию `c:\avr-gcc\bin` в переменную среды `path`.
4. Склонировать себе этот репозиторий.
5. Открыть коммандную строку и перейти в директорию со склонированным репозиторием.
6. Собрать проект можно следующей командой:

```
make all
```

## Hardwire

В качестве датчика температуры используется NTC термистор (обладает нелинейной зависимостью сопротивления от температуры).

В качестве нагревательного элемента - низкоомный резистор, например, типа ПЭВ (проволочный эмалированный трубчатый резистор) или SQP (цементный проволочный резистор).

Для управления количеством выделяющейся тепловой мощности на резисторе используется транзистор (биполярный или полевой).

Транзистор управляется ШИМ-сигналом, генерируемым микроконтроллером.

Необходимо использовать дисплей для отображения текущих параметром процесса и для задания коэффициентов ПИД.

Используется дисплей 1602 с модифицированной библиотекой [avr-hd44780](https://github.com/aostanin/avr-hd44780/tree/master).

Индикация информации на дисплее в рабочем режиме:
 - Уставка температуры: 0-120 градусов;
 - Измеренная температура: 0-120 градусов;
 - Коэффициент ШИМ: 0-255.

Индикация информации на дисплее в режиме подстройки коэффициентов:
 - Kp: 0.000 - 0.999
 - Kd: 0.000 - 0.999
 - Ki: 0.000 - 0.999

## Firmware

Задачи:
 - Вычисление температуры NTC термистора табличными методом;
 - Сохранение ПИД коэффициентов в энергонезависимую память EEPROM;
 - Отображение параметров рабочего режима на ЖК экране 1602;
 - Меню настройки коэффициентов ПИД;
 - Вывод на экран относительных единиц (0.000 - 0.999);
 - Преобразование именованных единиц температуры (уставка) в относительные (0.000 - 0.999);
 - Вычисление коэффициента заполнения ШИМ (0 - 255) по относительному значению (0.000 - 0.999);
